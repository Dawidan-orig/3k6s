Чтение должно быть доступно всем, запись - только одному и никому более. Вот и вся задача.

```lua
ЧИТАТЕЛЬ  
r.enter  
mutex1.enter  
readcount = readcount + 1  
if readcount=1 then w.enter  
mutex1.leave  
r.leave  
  
...читаем...  
  
mutex1.enter  
readcount = readcount - 1  
if readcount = 0 then w.leave  
mutex1.leave  
  
ПИСАТЕЛЬ  
mutex2.enter  
writecount = writecount + 1  
if writecount=1 then r.enter  
mutex2.leave  
  
w.enter  
...пишем...  
w.leave  
  
mutex2.enter  
writecount = writecount - 1  
if writecount = 0 then r.leave  
mutex2.leave
```
