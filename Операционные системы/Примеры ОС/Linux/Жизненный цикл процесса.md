Связь [[Состояния процесса]]

#Переписать блок-схемку

Появление Процесса описано в [[Команда fork и vfork]]

fork() - вызывает новый [[Процесс]], дублируя вызывающий
exec() - Запуск
wait() - Перевод в Runnable
exit() - Уничтожение процесса (Перевод в Zombie)

После смерти делается следующее:
- [[Linux task structure]] -> Ставим в поле flags PF_EXITING, чтоб другие системы отвязались от процесса
- del_timer_sync() - удаляем таймеры ядра. Это позволяет обработчикам и планировщику забыть об этом процессе, из-за чего тот выходит из системы.
- do_exit() -> acct_update_integrals() - записываем информацию об использованных ресурсах. Если включено.
- exit_mm() -> освобождаем ВАП.
- exit_sem() -> удаление из очереди [[Семафор|семафора]] подсистемы [[IPC]]
- exit_files(), exit_fs() -> уменьшение переменных-счётчиков использования файлов у дескрипторов этих файлов. Они удалятся, если счётчик станет нулевым.
- Ставится код завершения задачи в поле exit_code и передаётся дальше как return у exit()
- exit_notify() - сообщаем родительскому процессу через [[Аппаратное и Программное прерывания|сигнал]]. Новым родителем на время удаления становится либо какой-нибудь поток-удалятор, либо процесс init (PID=1)
- do_exit() -> schelude() -> Добиваем текущий процесс и переключаемся на новый.

Но остался ещё дескриптор процесса со структурами. Он не удаляется сразу, чтоб родитель мог прочитать данные-результаты. Процесс будет Zombie.

Тем не менее, вот процесс удаления дескриптора:
- release_task() -> \_\_exit_signal() -> \_\_unhash_process() -> detach_pid() -> удаляем процесс из [[Хэш-таблицы]] для PID и из списка задач
-  \_\_exit_signal() -> освобождаются вообще все связанные ресурсы, которые ещё используются процессом. Ещё могут подбиться статистические данные об использовании системных ресурсов.
- release_task() -> (Если многопоточность) уведомляем родителя-лидера группы потоков об удалении
- release_task() -> put_task_struct() -> Освобождаем страницы памяти у [[Lunix Thread Info]] и [[Linux task structure]].

Готово. Вы полностью убили процесс. Монстры.