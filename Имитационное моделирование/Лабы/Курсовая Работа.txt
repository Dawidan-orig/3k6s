* Что есть что:
* ti - интервал поступления заявок на АРМ
* Дti - время поступления первой заявки
* ni - количество заявок
* tki - время на КММ с АРМi
* T - Время обработки заявок

* Шпаргалка о функциях:
* Первый аргумент:
* RN{n} - случайный выбор от 0 до n
* Переменная.
* P{n} - взятие n параметра транзакта
* Второй:
* C - Непрерывная функция.
* D - Дискретная
* E - Таблица
* Число после буквы - количество пар

* Шпаргалка об Generate
* Частота создания
* Случайное смещение от частоты
* встроенный Advance
* Число транзактов
* Приоритет
* Число параметров
* Формат параметров

* Шпаргалка об Advance
* Добавочное число (Либо число как есть)
* Значение случайного интервала от

* Шпаргалка об Transfer
* вероятность
* иначе
* Если попало в указанную вероятность

* шаблон занятия устройства
*	QUEUE Q
*	SEIZE T
*	DEPART Q
*	ADVANCE 
*	RELEASE T

*===========ПРОГРАММА=================

* P1 = ИЗ КАКОГО ТЕРМИНАЛА ПРИШЛИ
* P2 = ИЗ CVK ИЛИ ARM ПРИШЛИ

	REALLOCATE COM,32720
	SIMULATE

* ===ПЕРЕМЕННЫЕ===
	INITIAL X$GEMEIN,0

	INITIAL X$FIRTOTAL,0
	INITIAL X$SECTOTAL,0
	INITIAL X$THRTOTAL,0

	INITIAL X$FIRFLICK,0
	INITIAL X$SECFLICK,0
	INITIAL X$THRFLICK,0
* ===ФУНКЦИИ===
*Подсчёт количества транзактов по первому параметру
GETALL FUNCTION P1,E3
1,FIRTOTAL/2,SECTOTAL/3,THRTOTAL

*подсчёт счётчиков сброса по первому параметру
GETFLI FUNCTION P1,E3
1,FIRFLICK/2,SECFLICK/3,THRFLICK

*Распределитель на счётчики сброса
DISTRFLI FUNCTION P1,E3
1,5/2,4/3,3

*Возврат в сооветствующий T (Терминал)
TOT FUNCTION P1,E3
1,TONE/2,TTWO/3,TTHR

*Распределить времени выполнения для ARM
TIMEARM FUNCTION RN1,C3
.1,16/.8,25/1,30

*Рапределитель для KMM у транзактов, пришедших с T3
TIMEKMMT FUNCTION RN2,C2
.2,3/1,1

*Распределитель времени для KMM
TIMEKMM FUNCTION P1,E3
1,2/2,3/3,FN$TIMEKMMT

*==МЕТКИ===
*---УНИЧТОЖЕНИЕ---
KILL	TERMINATE

*---T1---
	GENERATE 120,5,,57
	ASSIGN 1,1
TONE	QUEUE QTONE
	SEIZE T1
	DEPART QTONE
	PRIORITY 1
	ADVANCE 30,10 *(30+-10)
	RELEASE T1
	SAVEVALUE FN$GETALL+,1
	TEST NE P3,1,KILL
	TRANSFER ,ARM1

*---T2---
	GENERATE 200,,,18
	ASSIGN 1,2
TTWO	QUEUE QTTWO
	SEIZE T2
	DEPART QTTWO
	PRIORITY 1
	ADVANCE 33,5 *(33+-5)
	RELEASE T2
	SAVEVALUE FN$GETALL+,1
	TEST NE P3,1,KILL
	TRANSFER ,ARM2

*---T3---
	GENERATE 90,15,,45
	ASSIGN 1,3
TTHR	QUEUE QTTHR
	SEIZE T3
	DEPART QTTHR
	PRIORITY 1
	ADVANCE 35,12 *(35+-12)
	RELEASE T3
	SAVEVALUE FN$GETALL+,1
	TEST NE P3,1,KILL
	TRANSFER ,ARM3
	
*---ARM1---
ARM1	QUEUE QARM1
	SEIZE ARM1
	DEPART QARM1
	ADVANCE FN$TIMEARM
	RELEASE ARM1
	ASSIGN 2,0
	PRIORITY 5
	TRANSFER .3,TONE,KMML

*---ARM2---
ARM2	QUEUE QARM2
	SEIZE ARM2
	DEPART QARM2
	ADVANCE FN$TIMEARM
	RELEASE ARM2
	ASSIGN 2,0
	PRIORITY 5
	TRANSFER .3,TTWO,KMML

*---ARM3---
ARM3	QUEUE QARM3
	SEIZE ARM3
	DEPART QARM3
	ADVANCE FN$TIMEARM
	RELEASE ARM3
	ASSIGN 2,0
	PRIORITY 5
	TRANSFER .3,TTHR,KMML

*---KMM---
KMML	QUEUE QKMM
	LINK KMMBUNDL,FIFO,KMMG
KMMG	DEPART QKMM
	ADVANCE FN$TIMEKMM
	UNLINK KMMBUNDL,KMMG,1
	TEST E P2,1,CVK *Второй параметер показывает, откуда пришли. 0=ARM, 1=CVK(Передача в терминал)
	TEST G FN$GETFLI,FN$DISTRFLI,KMMSK
	ASSIGN 3,1
	SAVEVALUE FN$GETFLI,0 *аннулируем соответствующий счётчик
KMMSK	TRANSFER ,FN$TOT

*---CVK---
CVK	ASSIGN 2,1
	QUEUE QCVK
	SEIZE CVK
	DEPART QCVK
	ADVANCE 40,5
	RELEASE CVK
	SAVEVALUE FN$GETFLI+,1
	SAVEVALUE GEMEIN+,1
	PRIORITY 4
	TEST L X$GEMEIN,300,TOEND
	TRANSFER ,KMML

*===КОНЕЦ===
TOEND	TERMINATE 1
	
	START 1
	END